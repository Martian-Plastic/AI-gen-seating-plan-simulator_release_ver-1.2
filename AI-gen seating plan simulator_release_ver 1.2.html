<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seating Plan App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .panel {
            border: #ccc 1px solid;
            padding: 15px;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        
        .panel h3 {
            margin-top: 0;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        
        .student-box {
            border: 1px solid #ccc;
            padding: 8px;
            margin: 5px;
            cursor: move;
            border-radius: 4px;
            position: relative;
        }
        
        .student-box.male {
            background-color: #82CAFF;
        }
        
        .student-box.female {
            background-color: #FFC0CB;
        }
        
        .student-box.placed {
            background-color: #FFF380;
        }
        
        .student-box.selected {
            border: 2px solid #ffcc00;
            box-shadow: 0 0 5px rgba(255, 204, 0, 0.5);
        }
        
        .seat {
            width: 120px;
            height: 80px;
            border: 2px dashed #ccc;
            margin: 5px;
            display: inline-block;
            position: relative;
            text-align: center;
            line-height: 1.2;
            background-color: white;
            border-radius: 4px;
            padding: 5px;
            box-sizing: border-box;
            overflow: hidden;
        }
        
        .seat.selected {
            border: 2px solid #ffcc00;
            box-shadow: 0 0 5px rgba(255, 204, 0, 0.5);
        }
        
        .seat.correct {
            background-color: #d4edda;
        }
        
        .seat.incorrect {
            background-color: #f8d7da;
        }
        
        .table-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 10px;
        }
        
        .table {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .table-seats {
            display: flex;
        }
        
        .left-seats, .right-seats {
            display: flex;
            flex-direction: column;
        }
        
        .seating-plan {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        
        .row {
            display: contents;
        }
        
        .status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }
        
        .student-names-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .folder {
            margin: 20px 0 10px 0;
            cursor: pointer;
            padding: 8px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            border-radius: 4px;
        }
        
        .folder.selected {
            background-color: #d4e6f1;
            border-color: #5bc0de;
        }
        
        .folder-content {
            margin-left: 10px;
        }
        
        .progress-bar {
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s;
        }
        
        .context-menu {
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
        }
        
        .context-menu-item {
            padding: 8px 15px;
            cursor: pointer;
        }
        
        .context-menu-item:hover {
            background-color: #f0f0f0;
        }
        
        button {
            padding: 8px 12px;
            margin: 5px 0;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button.secondary {
            background-color: #6c757d;
        }
        
        button.secondary:hover {
            background-color: #5a6268;
        }
        
        input, select {
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }
        
        .correct-answers {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .student-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .student-form input, .student-form select {
            margin: 0;
        }
        
        .timer-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .timer {
            font-size: 18px;
            font-weight: bold;
        }
        
        .seat-class {
            font-weight: bold;
            font-size: 14px;
        }
        
        .seat-name {
            font-size: 16px;
            margin-top: 5px;
        }
        
        .credits {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f0f0;
            border-radius: 5px;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .folder-actions {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }
        
        .folder-actions button {
            padding: 3px 6px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="main-content">
        <div class="dashboard">
            <div class="panel">
                <h3>Student Information</h3>
                <div class="student-form">
                    <input type="text" id="classInput" placeholder="Class (e.g. 5A)">
                    <input type="text" id="studentClassNumber" placeholder="Class number (e.g. 12)">
                    <input type="text" id="studentName" placeholder="Student name (e.g. Chan Tai Man)">
                    <select id="studentGender">
                        <option value="M">Male</option>
                        <option value="F">Female</option>
                    </select>
                </div>
                <button onclick="setClass()">Set Class</button>
                <button onclick="addStudentToFolder()">Add student to folder</button>
            </div>
            
            <div class="panel">
                <h3>Folders</h3>
                <input type="text" id="folderInput" placeholder="Enter folder name">
                <button onclick="createFolder()">Create Folder</button>
            </div>
            
            <div class="panel">
                <h3>Check</h3>
                <button onclick="setupCorrectAnswers()">Setup Correct Answers</button>
                <button onclick="checkAnswers()">Check Answers</button>
                <button onclick="toggleCorrectAnswers()">Show Correct Answers</button>
                <button onclick="refresh()">Refresh</button>
            </div>
            
            <div class="panel">
                <h3>Timer</h3>
                <div class="timer-container">
                    <div class="timer" id="timer">00:00</div>
                    <button onclick="stopTimer()" class="secondary">Stop</button>
                    <button onclick="restartTimer()" class="secondary">Restart</button>
                    <button onclick="resetTimer()" class="secondary">Reset to 0</button>
                </div>
            </div>
        </div>
        
        <div class="seating-plan" id="seatingPlan">
            <!-- Row 1 -->
            <div class="row">
                <div class="table-container">
                    <div class="table">Table 4</div>
                    <div class="table-seats">
                        <div class="left-seats">
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                        </div>
                        <div class="right-seats">
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table">Table 5</div>
                    <div class="table-seats">
                        <div class="left-seats">
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                        </div>
                        <div class="right-seats">
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table">Table 6</div>
                    <div class="table-seats">
                        <div class="left-seats">
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                        </div>
                        <div class="right-seats">
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Row 2 -->
            <div class="row">
                <div class="table-container">
                    <div class="table">Table 1</div>
                    <div class="table-seats">
                        <div class="left-seats">
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                        </div>
                        <div class="right-seats">
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table">Table 2</div>
                    <div class="table-seats">
                        <div class="left-seats">
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                        </div>
                        <div class="right-seats">
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table">Table 3</div>
                    <div class="table-seats">
                        <div class="left-seats">
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                        </div>
                        <div class="right-seats">
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                            <div class="seat" data-correct-name="" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="selectElement(this)" oncontextmenu="showContextMenu(event, this)"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="status" id="status"></div>
        <div class="progress-bar">
            <div class="progress" id="progressBar"></div>
        </div>
        
        <div class="correct-answers" id="correctAnswers">
            <h3 id="correctAnswersTitle">Correct Answers</h3>
            <div id="correctList"></div>
        </div>
        
        <div class="credits">
            <div>Created by: Plastic :)</div>
            <div>AI Model: EdUHK GenAI deepseek-v3-0324</div>
            <div>Current Version: ver 1.0</div>
            <div>Release Date: 06/10/2025 (DD/MM/YYYY)</div>
            <div>Other remarks</div>
        </div>
    </div>
    
    <div class="student-names-container">
        <h3>Folders</h3>
        <div id="currentFolderDisplay">Current folder: <span id="currentFolderName">None</span></div>
        <div id="folderList"></div>
        
        <h3>Student Names</h3>
        <div id="nameList"></div>
    </div>
    
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" onclick="editSelectedItem()">Edit</div>
        <div class="context-menu-item" onclick="deleteSelectedItem()">Delete</div>
    </div>

    <script>
        let folders = JSON.parse(localStorage.getItem('folders')) || {};
        let currentFolder = localStorage.getItem('currentFolder') || '';
        let correctAnswers = JSON.parse(localStorage.getItem('correctAnswers')) || {};
        let currentClass = localStorage.getItem('currentClass') || '';
        let selectedElement = null;
        let selectedElementType = null; // 'student' or 'seat'
        let startTime = null;
        let timerInterval = null;
        let timerRunning = false;
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            loadFolders();
            if (currentFolder) {
                openFolder(currentFolder);
            }
            if (currentClass) {
                document.getElementById('classInput').value = currentClass;
            }
        });
        
        function startTimer() {
            if (timerRunning) return;
            
            startTime = new Date();
            timerInterval = setInterval(updateTimer, 1000);
            timerRunning = true;
        }
        
        function stopTimer() {
            clearInterval(timerInterval);
            timerRunning = false;
        }
        
        function restartTimer() {
            stopTimer();
            startTimer();
        }
        
        function resetTimer() {
            stopTimer();
            document.getElementById('timer').textContent = '00:00';
            startTime = new Date(); // Reset start time for next start
        }
        
        function updateTimer() {
            const now = new Date();
            const elapsed = new Date(now - startTime);
            const minutes = elapsed.getMinutes().toString().padStart(2, '0');
            const seconds = elapsed.getSeconds().toString().padStart(2, '0');
            document.getElementById('timer').textContent = `${minutes}:${seconds}`;
        }
        
        function setClass() {
            currentClass = document.getElementById('classInput').value.trim();
            if (!currentClass) {
                displayStatus("Please enter a class name", false);
                return;
            }
            
            localStorage.setItem('currentClass', currentClass);
            displayStatus(`Class set to ${currentClass}`, true);
            startTimer();
        }
        
        function addStudentToFolder() {
            const classNum = document.getElementById('studentClassNumber').value.trim();
            const name = document.getElementById('studentName').value.trim();
            const gender = document.getElementById('studentGender').value;
            
            if (!classNum || !name) {
                displayStatus("Please enter both class number and student name", false);
                return;
            }
            
            if (!currentFolder) {
                displayStatus("Please select a folder first", false);
                return;
            }
            
            if (!currentClass) {
                displayStatus("Please set the class first", false);
                return;
            }
            
            const studentId = `${currentClass}_${classNum}_${name}_${gender}`;
            createStudentBox(studentId, gender);
            
            // Add to folder
            if (!folders[currentFolder]) {
                folders[currentFolder] = [];
            }
            folders[currentFolder].push(studentId);
            localStorage.setItem('folders', JSON.stringify(folders));
            
            document.getElementById('studentClassNumber').value = '';
            document.getElementById('studentName').value = '';
            displayStatus(`Added student to folder "${currentFolder}"`, true);
        }
        
        function createStudentBox(studentId, gender) {
            const studentBox = document.createElement('div');
            studentBox.className = `student-box ${gender === 'M' ? 'male' : 'female'}`;
            studentBox.draggable = true;
            
            // Parse student info for display
            const parts = studentId.split('_');
            const displayText = parts.length === 4 ? 
                `${parts[0]}(${parts[1]})\n${parts[2]}` : studentId;
            
            studentBox.textContent = displayText;
            studentBox.setAttribute('data-student-id', studentId);
            studentBox.ondragstart = (event) => {
                event.dataTransfer.setData("text", studentId);
                event.dataTransfer.setData("source", "student");
            };
            studentBox.onclick = () => selectElement(studentBox, 'student');
            studentBox.oncontextmenu = (e) => {
                e.preventDefault();
                selectElement(studentBox, 'student');
                showContextMenu(e, studentBox);
            };
            document.getElementById('nameList').appendChild(studentBox);
            return studentBox;
        }
        
        function createFolder() {
            const folderName = document.getElementById('folderInput').value.trim();
            if (folderName) {
                if (!folders[folderName]) {
                    folders[folderName] = [];
                    localStorage.setItem('folders', JSON.stringify(folders));
                    
                    createFolderElement(folderName);
                    
                    document.getElementById('folderInput').value = '';
                    displayStatus(`Created folder "${folderName}".`, true);
                } else {
                    displayStatus(`Folder "${folderName}" already exists.`, false);
                }
            }
        }

        function createFolderElement(folderName) {
            const folderDiv = document.createElement('div');
            folderDiv.className = 'folder' + (folderName === currentFolder ? ' selected' : '');
            
            const folderNameSpan = document.createElement('span');
            folderNameSpan.textContent = folderName;
            folderNameSpan.style.cursor = 'pointer';
            folderNameSpan.onclick = () => openFolder(folderName);
            
            const folderActions = document.createElement('div');
            folderActions.className = 'folder-actions';
            
            const editBtn = document.createElement('button');
            editBtn.textContent = 'Edit';
            editBtn.className = 'secondary';
            editBtn.onclick = (e) => {
                e.stopPropagation();
                editFolder(folderName);
            };
            
            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = 'Delete';
            deleteBtn.className = 'secondary';
            deleteBtn.onclick = (e) => {
                e.stopPropagation();
                deleteFolder(folderName);
            };
            
            folderActions.appendChild(editBtn);
            folderActions.appendChild(deleteBtn);
            
            folderDiv.appendChild(folderNameSpan);
            folderDiv.appendChild(folderActions);
            
            document.getElementById('folderList').appendChild(folderDiv);
            return folderDiv;
        }

        function editFolder(oldName) {
            const newName = prompt('Enter new folder name:', oldName);
            if (newName && newName.trim() && newName !== oldName) {
                if (!folders[newName]) {
                    // Move all data to new name
                    folders[newName] = folders[oldName];
                    delete folders[oldName];
                    
                    // Update correct answers if needed
                    for (const className in correctAnswers) {
                        if (correctAnswers[className][oldName]) {
                            correctAnswers[className][newName] = correctAnswers[className][oldName];
                            delete correctAnswers[className][oldName];
                        }
                    }
                    
                    localStorage.setItem('folders', JSON.stringify(folders));
                    localStorage.setItem('correctAnswers', JSON.stringify(correctAnswers));
                    
                    if (currentFolder === oldName) {
                        currentFolder = newName;
                        localStorage.setItem('currentFolder', currentFolder);
                    }
                    
                    loadFolders();
                    displayStatus(`Folder renamed from "${oldName}" to "${newName}".`, true);
                } else {
                    displayStatus(`Folder "${newName}" already exists.`, false);
                }
            }
        }

        function deleteFolder(folderName) {
            if (confirm(`Are you sure you want to delete folder "${folderName}" and all its contents?`)) {
                delete folders[folderName];
                
                // Remove from correct answers
                for (const className in correctAnswers) {
                    if (correctAnswers[className][folderName]) {
                        delete correctAnswers[className][folderName];
                    }
                }
                
                localStorage.setItem('folders', JSON.stringify(folders));
                localStorage.setItem('correctAnswers', JSON.stringify(correctAnswers));
                
                if (currentFolder === folderName) {
                    currentFolder = '';
                    localStorage.setItem('currentFolder', '');
                    document.getElementById('nameList').innerHTML = '';
                }
                
                loadFolders();
                displayStatus(`Folder "${folderName}" deleted.`, true);
            }
        }
        
        function loadFolders() {
            const folderList = document.getElementById('folderList');
            folderList.innerHTML = '';
            
            for (const folderName in folders) {
                createFolderElement(folderName);
            }
            
            document.getElementById('currentFolderName').textContent = currentFolder || 'None';
        }
        
        function openFolder(folderName) {
            currentFolder = folderName;
            localStorage.setItem('currentFolder', currentFolder);
            
            const nameList = document.getElementById('nameList');
            nameList.innerHTML = '';
            
            if (folders[folderName]) {
                folders[folderName].forEach(studentId => {
                    const gender = studentId.split('_')[3] || 'M';
                    createStudentBox(studentId, gender);
                });
            }
            
            loadFolders();
            displayStatus(`Opened folder "${folderName}".`, true);
        }
        
        function setupCorrectAnswers() {
            if (!currentFolder || !currentClass) {
                displayStatus("Please select both a folder and a class first.", false);
                return;
            }
            
            const seats = document.querySelectorAll('.seat');
            const answers = {};
            
            seats.forEach((seat, index) => {
                const table = seat.closest('.table-container').querySelector('.table').textContent;
                const position = Array.from(seat.parentNode.children).indexOf(seat);
                const side = seat.parentNode.classList.contains('left-seats') ? 'left' : 'right';
                
                const key = `${table}-${side}-${position}`;
                answers[key] = seat.textContent ? seat.getAttribute('data-student-id') || seat.textContent : '';
            });
            
            // Store answers with class and folder
            if (!correctAnswers[currentClass]) {
                correctAnswers[currentClass] = {};
            }
            correctAnswers[currentClass][currentFolder] = answers;
            localStorage.setItem('correctAnswers', JSON.stringify(correctAnswers));
            displayStatus(`Correct answers saved for Class ${currentClass}, folder "${currentFolder}".`, true);
        }
        
        function toggleCorrectAnswers() {
            if (!currentFolder || !currentClass) {
                displayStatus("Please select both a folder and a class first.", false);
                return;
            }
            
            const correctAnswersDiv = document.getElementById('correctAnswers');
            const correctList = document.getElementById('correctList');
            
            if (correctAnswersDiv.style.display === 'block') {
                correctAnswersDiv.style.display = 'none';
                return;
            }
            
            correctList.innerHTML = '';
            
            // Set the title to show which class and folder these answers are for
            document.getElementById('correctAnswersTitle').textContent = 
                `Correct Answers for Class ${currentClass}, Folder "${currentFolder}"`;
            
            if (correctAnswers[currentClass] && correctAnswers[currentClass][currentFolder]) {
                const classAnswers = correctAnswers[currentClass][currentFolder];
                for (const [key, studentId] of Object.entries(classAnswers)) {
                    if (studentId) {
                        const div = document.createElement('div');
                        const parts = studentId.split('_');
                        const displayText = parts.length === 4 ? 
                            `${key}: ${parts[0]}(${parts[1]}) ${parts[2]}` : `${key}: ${studentId}`;
                        div.textContent = displayText;
                        correctList.appendChild(div);
                    }
                }
            } else {
                correctList.textContent = "No correct answers set for this class and folder.";
            }
            
            correctAnswersDiv.style.display = 'block';
        }
        
        function allowDrop(event) {
            event.preventDefault();
        }
        
        function drop(event) {
            event.preventDefault();
            const studentId = event.dataTransfer.getData("text");
            const source = event.dataTransfer.getData("source");
            const seat = event.target;
            
            if (source === 'student' && seat.classList.contains('seat')) {
                // Mark student as placed
                const studentBoxes = document.querySelectorAll('.student-box');
                studentBoxes.forEach(box => {
                    if (box.getAttribute('data-student-id') === studentId) {
                        box.classList.add('placed');
                    }
                });
                
                // Format the display for the seat
                const parts = studentId.split('_');
                if (parts.length === 4) {
                    seat.innerHTML = `<div class="seat-class">${parts[0]}(${parts[1]})</div>
                                      <div class="seat-name">${parts[2]}</div>`;
                } else {
                    seat.textContent = studentId;
                }
                seat.setAttribute('data-student-id', studentId);
                checkSeat(seat);
            }
        }
        
        function checkSeat(seat) {
            if (!currentFolder || !currentClass || !correctAnswers[currentClass] || !correctAnswers[currentClass][currentFolder]) return;
            
            const table = seat.closest('.table-container').querySelector('.table').textContent;
            const position = Array.from(seat.parentNode.children).indexOf(seat);
            const side = seat.parentNode.classList.contains('left-seats') ? 'left' : 'right';
            
            const key = `${table}-${side}-${position}`;
            const classAnswers = correctAnswers[currentClass][currentFolder];
            const correctStudentId = classAnswers[key] || '';
            const currentStudentId = seat.getAttribute('data-student-id') || '';
            
            seat.classList.remove('correct', 'incorrect');
            
            if (currentStudentId && currentStudentId === correctStudentId) {
                seat.classList.add('correct');
            } else if (currentStudentId && correctStudentId) {
                seat.classList.add('incorrect');
            }
            
            updateProgress();
        }
        
        function updateProgress() {
            if (!currentFolder || !currentClass || !correctAnswers[currentClass] || !correctAnswers[currentClass][currentFolder]) return;
            
            const seats = document.querySelectorAll('.seat');
            let correct = 0;
            let total = 0;
            
            seats.forEach(seat => {
                if (seat.getAttribute('data-student-id')) {
                    total++;
                    if (seat.classList.contains('correct')) {
                        correct++;
                    }
                }
            });
            
            const percentage = total > 0 ? Math.round((correct / total) * 100) : 0;
            document.getElementById('progressBar').style.width = `${percentage}%`;
            displayStatus(`Correct: ${correct}/${total} (${percentage}%)`, percentage === 100);
        }
        
        function checkAnswers() {
            const seats = document.querySelectorAll('.seat');
            seats.forEach(seat => checkSeat(seat));
        }
        
        function refresh() {
            const seats = document.querySelectorAll('.seat');
            seats.forEach(seat => {
                seat.textContent = '';
                seat.removeAttribute('data-student-id');
                seat.classList.remove('correct', 'incorrect');
            });
            
            // Remove placed status from students and restore original colors
            document.querySelectorAll('.student-box.placed').forEach(box => {
                box.classList.remove('placed');
                const studentId = box.getAttribute('data-student-id');
                if (studentId) {
                    const gender = studentId.split('_')[3] || 'M';
                    box.className = `student-box ${gender === 'M' ? 'male' : 'female'}`;
                }
            });
            
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('status').textContent = '';
            restartTimer();
            
            if (!currentFolder) {
                document.getElementById('nameList').innerHTML = '';
            }
        }
        
        function selectElement(element, type) {
            // Remove selection from all elements
            document.querySelectorAll('.selected').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Select the new element
            if (element) {
                element.classList.add('selected');
                selectedElement = element;
                selectedElementType = type;
            } else {
                selectedElement = null;
                selectedElementType = null;
            }
        }
        
        function showContextMenu(event, element) {
            event.preventDefault();
            selectElement(element, element.classList.contains('student-box') ? 'student' : 'seat');
            
            const contextMenu = document.getElementById('contextMenu');
            contextMenu.style.display = 'block';
            contextMenu.style.left = `${event.pageX}px`;
            contextMenu.style.top = `${event.pageY}px`;
            
            // Hide the menu when clicking elsewhere
            const hideMenu = () => {
                document.removeEventListener('click', hideMenu);
                contextMenu.style.display = 'none';
            };
            
            document.addEventListener('click', hideMenu);
        }
        
        function editSelectedItem() {
            if (!selectedElement) return;
            
            if (selectedElementType === 'student') {
                const currentId = selectedElement.getAttribute('data-student-id');
                const parts = currentId.split('_');
                let newId = currentId;
                
                if (parts.length === 4) {
                    const newClassNumber = prompt('Edit class number:', parts[1]);
                    const newName = prompt('Edit student name:', parts[2]);
                    const newGender = prompt('Edit gender (M/F):', parts[3]);
                    
                    if (newClassNumber !== null && newName !== null && newGender !== null) {
                        newId = `${parts[0]}_${newClassNumber}_${newName}_${newGender}`;
                    }
                } else {
                    newId = prompt('Edit student ID:', currentId);
                }
                
                if (newId !== null && newId.trim() !== '') {
                    selectedElement.setAttribute('data-student-id', newId.trim());
                    const newParts = newId.split('_');
                    const displayText = newParts.length === 4 ? 
                        `${newParts[0]}(${newParts[1]})\n${newParts[2]}` : newId;
                    selectedElement.textContent = displayText;
                    
                    // Update in the current folder if this is a student
                    if (currentFolder) {
                        const index = Array.from(selectedElement.parentNode.children).indexOf(selectedElement);
                        if (index >= 0 && folders[currentFolder]) {
                            folders[currentFolder][index] = newId.trim();
                            localStorage.setItem('folders', JSON.stringify(folders));
                        }
                    }
                }
            } else if (selectedElementType === 'seat') {
                const currentName = selectedElement.textContent;
                const newName = prompt('Edit student:', currentName);
                
                if (newName !== null && newName.trim() !== '') {
                    selectedElement.textContent = newName.trim();
                    checkSeat(selectedElement);
                }
            }
        }
        
        function deleteSelectedItem() {
            if (!selectedElement) return;
            
            if (confirm('Are you sure you want to delete this item?')) {
                if (selectedElementType === 'student') {
                    // Remove from the current folder if this is a student
                    if (currentFolder) {
                        const index = Array.from(selectedElement.parentNode.children).indexOf(selectedElement);
                        if (index >= 0 && folders[currentFolder]) {
                            folders[currentFolder].splice(index, 1);
                            localStorage.setItem('folders', JSON.stringify(folders));
                        }
                    }
                    selectedElement.remove();
                } else if (selectedElementType === 'seat') {
                    // For seats, just clear the name but keep the seat
                    const studentId = selectedElement.getAttribute('data-student-id');
                    if (studentId) {
                        // Find the student box and restore original color
                        const studentBoxes = document.querySelectorAll('.student-box');
                        studentBoxes.forEach(box => {
                            if (box.getAttribute('data-student-id') === studentId) {
                                box.classList.remove('placed');
                                const gender = studentId.split('_')[3] || 'M';
                                box.className = `student-box ${gender === 'M' ? 'male' : 'female'}`;
                            }
                        });
                    }
                    selectedElement.textContent = '';
                    selectedElement.removeAttribute('data-student-id');
                    selectedElement.classList.remove('correct', 'incorrect');
                    updateProgress();
                }
                
                selectedElement = null;
                selectedElementType = null;
            }
        }
        
        function displayStatus(message, isSuccess) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.style.backgroundColor = isSuccess ? '#d4edda' : '#f8d7da';
            statusDiv.style.color = isSuccess ? '#155724' : '#721c24';
        }
    </script>
</body>
</html>